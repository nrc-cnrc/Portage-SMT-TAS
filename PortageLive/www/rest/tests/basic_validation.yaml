# @file rest/tests/basic_validation.yaml
# @brief Validates PortageLive REST API's handling of arguments for translate.
#
# @author Samuel Larkin
#
# Technologies langagieres interactives / Interactive Language Technologies
# Inst. de technologie de l'information / Institute for Information Technology
# Conseil national de recherches Canada / National Research Council Canada
# Copyright 2016, Sa Majeste la Reine du Chef du Canada /
# Copyright 2016, Her Majesty in Right of Canada


# https://learnxinyminutes.com/docs/yaml/

name: "Exercice validating the parameters."

globals:
  variables:
    service: "{base_url}/language/translate/v3.php"

testSteps:
  - name: "No query"
    method: "get"
    apiUrl: "{service}"
    asserts:
      headers:
        status: 404
        Content-Type: "application/json"
      payload:
         Error: "Object"
         Error.message: "String"
         Error.message: "There is no query."


  - name: "No target"
    method: "get"
    apiUrl: "{service}"
    params:
      key: "unittest.rev-"
      prettyprint: false
      q: "home"
    asserts:
      headers:
        status: 404
        Content-Type: "application/json"
      payload:
         Error: "Object"
         Error.message: "String"
         Error.message: "You need to provide a target using target=X."


  - name: "Empty target"
    method: "get"
    apiUrl: "{service}"
    params:
      key: "unittest.rev-"
      target: ""
      prettyprint: false
      q: "home"
    asserts:
      headers:
        status: 404
        Content-Type: "application/json"
      payload:
         Error: "Object"
         Error.message: "String"
         Error.message: "You need to provide a target using target=X."


  - name: "There should be a query."
    method: "get"
    apiUrl: "{service}"
    params:
      key: "unittest.rev-"
      target: "fr"
      prettyprint: false
    asserts:
      headers:
        status: 404
        Content-Type: "application/json"
      payload:
         Error: "Object"
         Error.message: "String"
         Error.message: "You need to provide a query using q=X."


  - name: "Generating a SOAPFault with an invalid context/key."
    method: "get"
    apiUrl: "{service}"
    params:
      key: "invalid_context"
      target: "fr"
      prettyprint: false
      q: "home"
    asserts:
      headers:
        status: 404
        Content-Type: "application/json"
      payload:
         Error: "Object"
         Error.type: "String"
         Error.type: "PortageContext"
         Error.message: "String"
         Error.message: 'exec value.strip() == "Context \"invalid_contexten-fr\" does not exist."'


  - name: "Translate not pretty printed"
    apiUrl: "{service}"
    method: "get"
    raw: true
    params:
      key: "unittest.rev-"
      target: "fr"
      prettyprint: false
      q: "home"
    asserts:
      headers:
        status: 200
        Content-Type: "application/json"
      payload:
        __raw__: '{"data":{"translations":[{"translatedText":"emoh"}]}}'


  - name: "Translate pretty printed"
    method: "get"
    apiUrl: "{service}"
    raw: true
    params:
      key: "unittest.rev-"
      target: "fr"
      prettyprint: true
      q: "home"
    asserts:
      headers:
        status: 200
        Content-Type: "application/json"
      payload:
        __raw__: |
         {
             "data": {
                 "translations": [
                     {
                         "translatedText": "emoh"
                     }
                 ]
             }
         }

